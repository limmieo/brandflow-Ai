<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Processing Your Video</title>
  <style>
    body {
      font-family: sans-serif;
      display:flex; align-items:center; justify-content:center;
      height:100vh; margin:0; background:#f7f7f7;
    }
    .box {
      background:white;
      padding:2rem;
      border-radius:8px;
      text-align:center;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      width:90%; max-width:500px;
    }
    .spinner {
      width:50px; height:50px;
      border:6px solid #e0e0e0;
      border-top:6px solid #007bff;
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin:1rem auto;
    }
    @keyframes spin { to { transform:rotate(360deg); } }
    .progress {
      height:1.5rem; background:#e0e0e0;
      border-radius:4px; overflow:hidden;
      margin:1.5rem 0;
    }
    .progress-bar {
      height:100%; width:0;
      background:#007bff;
      transition:width 0.3s;
    }
    .download { margin-top:1.5rem; }
    .download a {
      display:inline-block; padding:0.75rem 1.5rem;
      background:#28a745; color:white; border-radius:4px;
      text-decoration:none;
    }
    .download a:hover { background:#218838; }
    .error { color:red; margin-top:1rem; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Processing Your Video</h2>
    <div class="spinner"></div>
    <p>Please wait while we process your videoâ€¦</p>
    <div class="progress">
      <div id="bar" class="progress-bar"></div>
    </div>
    <div id="download" class="download"></div>
    <div id="error" class="error"></div>
  </div>

  <script>
    function tick() {
      fetch("/progress")
        .then(r => r.json())
        .then(data => {
          // Progress
          document.getElementById("bar").style.width = data.progress + "%";

          // Error?
          if (data.error) {
            document.getElementById("error").innerText = data.error;
            return;
          }

          // Done?
          if (data.progress === 100 && data.filename) {
            document.getElementById("download").innerHTML = 
              `<a href="/download/${data.filename}" target="_blank">
                 Download Processed Video
               </a>`;
          } else if (data.progress < 100) {
            // schedule next poll
            setTimeout(tick, 500);
          }
        })
        .catch(err => {
          console.error(err);
          setTimeout(tick, 1000);
        });
    }

    window.onload = tick;
  </script>
</body>
</html>
