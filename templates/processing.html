<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Processing Video</title>
  <style>
    body { font-family: Arial; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; }
    .box { text-align:center; }
    .loader { border:6px solid #eee; border-top:6px solid #3498db; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin:20px auto; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .bar { width:300px; height:20px; background:#ddd; margin:10px auto; border-radius:10px; overflow:hidden; }
    .fill { height:100%; width:0%; background:#3498db; transition:width .3s; }
    .download { margin-top:20px; }
    .download a { color:#007bff; text-decoration:none; font-weight:bold; }
    .download a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Processing Your Video</h2>
    <div class="loader"></div>
    <p>Please wait…</p>

    <div class="bar"><div id="fill" class="fill"></div></div>
    <div id="download" class="download"></div>
  </div>

  <script>
    const taskId = "{{ task_id }}";
    const fill   = document.getElementById("fill");
    const dlDiv  = document.getElementById("download");

    function poll() {
      fetch(`/progress/${taskId}`)
        .then(r=>r.json())
        .then(data=>{
          fill.style.width = data.progress + "%";

          if (data.progress < 100) {
            setTimeout(poll, 300);
          } else if (data.filename) {
            dlDiv.innerHTML = `
              <p>✅ Done!</p>
              <a href="/download/${data.filename}" target="_blank">
                Download your video
              </a>`;
          }
        });
    }

    window.onload = poll;
  </script>
</body>
</html>
